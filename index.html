<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teknohıfz Dijital Forum (Yerel)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* GitHub dark mode background */
        }
        /* Custom scrollbar for a digital/tech look */
        .forum-container::-webkit-scrollbar {
            width: 8px;
        }
        .forum-container::-webkit-scrollbar-thumb {
            background-color: #38a169; /* Green accent */
            border-radius: 4px;
        }
        .forum-container::-webkit-scrollbar-track {
            background: #161b22;
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen p-4 sm:p-8 flex justify-center">
        <div class="w-full max-w-4xl">
            <!-- Header -->
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-[#38a169] tracking-tight">
                    Teknohıfz Dijital (Yerel Sürüm)
                </h1>
                <p class="text-gray-400 mt-2 text-lg">
                    Anonim ve Şifresiz Dijital Pano. Veriler sadece sizin tarayıcınızda saklanır.
                </p>
                 <div class="mt-4 p-2 text-xs bg-gray-800 text-gray-500 rounded-lg">
                    <!-- Display storage info -->
                    Veri Depolama Yeri: <span class="font-mono text-gray-400">Yerel Tarayıcı Depolaması (`localStorage`)</span>
                </div>
            </header>

            <!-- New Topic Form -->
            <section class="bg-[#161b22] p-6 rounded-xl shadow-2xl mb-10 border border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-200 mb-4">Yeni Konu Oluştur</h2>
                <form id="newTopicForm" class="space-y-4">
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-400 mb-1">Adınız (Şifre yok):</label>
                        <input type="text" id="userName" required placeholder="Örn: Yerel Gezgin"
                               class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-white placeholder-gray-500 focus:ring-green-500 focus:border-green-500 transition duration-150">
                    </div>
                    <div>
                        <label for="topicContent" class="block text-sm font-medium text-gray-400 mb-1">Konu Mesajınız:</label>
                        <textarea id="topicContent" required rows="4" placeholder="Buraya yazmak istediğiniz konu veya mesajı girin..."
                                  class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 text-white placeholder-gray-500 focus:ring-green-500 focus:border-green-500 resize-none transition duration-150"></textarea>
                    </div>
                    <button type="submit" id="submitButton"
                            class="w-full px-4 py-3 bg-[#38a169] text-white font-bold rounded-lg hover:bg-green-700 transition duration-200 shadow-md focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50">
                        Yayınla (Yerel Kayıt)
                    </button>
                    <p id="messageBox" class="text-center text-sm text-red-400 mt-2 hidden"></p>
                </form>
            </section>

            <!-- Existing Topics List -->
            <section>
                <h2 class="text-3xl font-bold text-gray-200 mb-6 border-b border-gray-700 pb-2">Yayınlanan Konular (Yerel)</h2>
                <div id="topicsContainer" class="space-y-4 forum-container max-h-[60vh] overflow-y-auto">
                    <!-- Topics will be injected here by JavaScript -->
                    <p class="text-center text-gray-500 p-8" id="loadingMessage">Konular yükleniyor...</p>
                </div>
            </section>

        </div>
    </div>

    <script type="module">
        // ** Yerel Depolama (localStorage) Kullanımı **
        // Firebase ve bağımlılıkları kaldırılmıştır.

        // Sabit Depolama Anahtarı
        const LOCAL_STORAGE_KEY = 'forum_iletileri_local';

        // UI Elementleri
        const newTopicForm = document.getElementById('newTopicForm');
        const userNameInput = document.getElementById('userName');
        const topicContentInput = document.getElementById('topicContent');
        const topicsContainer = document.getElementById('topicsContainer');
        const loadingMessage = document.getElementById('loadingMessage');
        const messageBox = document.getElementById('messageBox');
        const submitButton = document.getElementById('submitButton');

        // Zaman damgasını okunabilir bir formata dönüştürür
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'Şimdi';
            // Standart Date nesnesinden tarih formatlama
            return new Date(timestamp).toLocaleString('tr-TR', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // Yerel depolamadan konuları yükler
        function loadTopics() {
            try {
                const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                return storedData ? JSON.parse(storedData) : [];
            } catch (error) {
                console.error("Yerel konular yüklenirken hata: ", error);
                return [];
            }
        }

        // Konuları yerel depolamaya kaydeder
        function saveTopics(topics) {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(topics));
            } catch (error) {
                console.error("Yerel konular kaydedilirken hata: ", error);
            }
        }

        // Konuları UI'ya render eden fonksiyon
        function renderTopics() {
            // Konuları yükle ve zamana göre yeniden eskiye doğru sırala
            const topics = loadTopics().sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            topicsContainer.innerHTML = '';
            loadingMessage.classList.add('hidden');

            if (topics.length === 0) {
                topicsContainer.innerHTML = '<p class="text-center text-gray-500 p-4">Henüz yayınlanmış bir konu yok. İlk konuyu siz başlatın!</p>';
                return;
            }

            topics.forEach(topic => {
                const topicElement = document.createElement('div');
                topicElement.className = 'p-5 bg-gray-800 rounded-lg shadow-md border border-gray-700 hover:border-[#38a169] transition duration-150';
                
                const formattedTime = formatTimestamp(topic.timestamp);

                topicElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2 border-b border-gray-700 pb-2">
                        <div class="text-lg font-bold text-gray-200">
                            ${topic.name || 'Anonim Kullanıcı'}
                        </div>
                        <div class="text-xs text-gray-500 mt-1 flex-shrink-0 ml-4">
                            ${formattedTime}
                        </div>
                    </div>
                    <p class="text-base text-gray-300 whitespace-pre-wrap">${topic.topic}</p>
                `;
                topicsContainer.appendChild(topicElement);
            });
        }

        // Yeni konu ekleme fonksiyonu
        function addNewTopic(event) {
            event.preventDefault();

            submitButton.disabled = true;
            submitButton.textContent = 'Kaydediliyor...';
            messageBox.classList.add('hidden');

            const name = userNameInput.value.trim() || 'Anonim';
            const topic = topicContentInput.value.trim();

            if (topic.length === 0) {
                messageBox.textContent = 'Lütfen bir konu mesajı giriniz.';
                messageBox.classList.remove('hidden');
                submitButton.disabled = false;
                submitButton.textContent = 'Yayınla (Yerel Kayıt)';
                return;
            }

            try {
                const currentTopics = loadTopics();

                // Yeni konuyu oluştur
                const newTopic = {
                    id: Date.now(), // Basit bir ID
                    name: name,
                    topic: topic,
                    timestamp: new Date().toISOString(), // ISO formatında zaman damgası
                };

                // Listeye ekle ve kaydet
                currentTopics.push(newTopic);
                saveTopics(currentTopics);

                // UI'ı güncelle
                renderTopics();

                // Başarıyla eklendi, formu temizle
                topicContentInput.value = '';
                localStorage.setItem('lastUserName', name);
                
                messageBox.textContent = 'Konu başarıyla yerel olarak kaydedildi!';
                messageBox.classList.remove('hidden');
                messageBox.classList.remove('text-red-400');
                messageBox.classList.add('text-green-400');
                setTimeout(() => messageBox.classList.add('hidden'), 3000);

            } catch (error) {
                console.error("Yeni konu eklenirken hata: ", error);
                messageBox.textContent = 'Konu kaydedilirken bir sorun oluştu: ' + error.message;
                messageBox.classList.remove('hidden');
                messageBox.classList.remove('text-green-400');
                messageBox.classList.add('text-red-400');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Yayınla (Yerel Kayıt)';
            }
        }

        // Uygulama Başlatma Fonksiyonu
        function initializeApp() {
            // Kullanıcı adını yerel depolamadan yükle
            const lastUserName = localStorage.getItem('lastUserName');
            if (lastUserName) {
                userNameInput.value = lastUserName;
            }

            // Sayfa yüklendiğinde konuları render et
            renderTopics();

            // Form dinleyicisini ekle
            newTopicForm.addEventListener('submit', addNewTopic);
        }
        
        // Uygulamayı başlat
        initializeApp();
    </script>
</body>
</html>
